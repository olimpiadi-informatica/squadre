<!--

    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    
    WARNING!
    Questa pagina viene fornita per verificare ***lato client*** l'effettivo
    blocco di internet. Non serve a niente tentare di modificare questo script,
    perche' il controllo ***effettivo*** viene eseguito in automatico durante
    la gara ***lato server***.

    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<html>
    <style>
    body {
        font-family: sans-serif;
        font-size: xx-large;
    }
    </style>

    <script>

    function display_failed() {
        document.getElementById("esito").innerHTML = "fallito";
        document.body.style.backgroundColor = "darkred";
    }

    function display_passed() {
        document.getElementById("esito").innerHTML = "superato";
        document.body.style.backgroundColor = "green";
    }

    var blocked = 0;
    function one_more_blocked() {
        blocked++;
        document.getElementById("successful-tests").innerHTML = blocked;
        if (blocked == tests.length)
            display_passed();
    }

    
    function do_test(target_url, json_field) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', target_url + '?nocache=' + (Math.random()).toString().replace('.',''));
        xhr.timeout = 15000;
        xhr.onload = function() {
            var res_json = JSON.parse(xhr.response);
            if (res_json[json_field].length > 0)
                display_failed();
            else
                one_more_blocked();
        }
        xhr.ontimeout = function() {
            one_more_blocked();
        }
        xhr.onerror = function() {
            one_more_blocked();
        }        
        xhr.send();
    }

    var tests = [
                    ["https://jsonplaceholder.typicode.com/posts/1", "body"],
                    ["https://httpbin.org/get", "url"],
                    ["https://reqres.in/api/users", "data"],
                    ["https://training.olinfo.it/ois-internet-check", "asd"]
                ];

    tests.forEach(function(test) {
            do_test(test[0], test[1]);
    });

    </script>

    <noscript>
        <style>
        body {
            background-color: darkred !important;
        }
        </style>
    </noscript>

    <body>
        <h1>Test internet:</h1>
        
        <h1 id="esito">(in corso...)</h1>

        <a style="color: gold" href="/resources/guida.pdf">Guida in PDF su come disabilitare internet</a>

        <br><br><hr>
        Version of this checker: <b>4</b> <br>
        Current UTC datetime: <b><span id="datetime"></span></b> <br>
        Successful tests: <b><span id="successful-tests">0</span>/4</b> <br>
        User agent: <b><span id="useragent"></span></b> <br>
    </body>

    <script>
        document.getElementById("datetime").innerHTML = (new Date()).toUTCString();
        document.getElementById("useragent").innerHTML = navigator.userAgent;
    </script>
<html>

